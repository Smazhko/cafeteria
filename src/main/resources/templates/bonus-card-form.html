<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Bonus Card Form</title>

    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/style_mobile.css}">
    <style>
        input[type="text"] {
            width: 200px;
            padding: 5px;
        }
        .error {
            color: red;
        }
    </style>
    <script>
        function formatPhoneNumber(value) {
            const digits = value.replace(/\D/g, '');
            let formattedNumber = '+';

            if (digits.startsWith('7')) {
                formattedNumber += '7(';
            } else {
                formattedNumber += digits.charAt(0) + '(';
            }

            if (digits.length > 1) {
                formattedNumber += digits.substring(1, 4);
            }
            if (digits.length >= 4) {
                formattedNumber += ')' + digits.substring(4, 7);
            }
            if (digits.length >= 7) {
                formattedNumber += '-' + digits.substring(7, 9);
            }
            if (digits.length >= 9) {
                formattedNumber += '-' + digits.substring(9, 11);
            }

            return formattedNumber;
        }

        function onPhoneInput(event) {
            const input = event.target;
            const formattedValue = formatPhoneNumber(input.value);
            input.value = formattedValue;
        }

        async function checkPhoneNumberExists(phone) {
            if (!validatePhoneNumber(phone)) {
                document.getElementById("phoneError").textContent = "Invalid phone format";
                return;
            }
            try {
                const response = await fetch(`/api/bonus-cards/check-phone?phone=${phone}`);
                const data = await response.json();
                if (data.exists) {
                    document.getElementById("phoneError").textContent = "Phone number already exists";
                } else {
                    document.getElementById("phoneError").textContent = "";
                }
            } catch (error) {
                console.error("Error checking phone number:", error);
            }
        }
    </script>
</head>
<body>
<form>
    <label for="phone">Phone Number:</label>
    <input type="text" id="phone" name="phone" onblur="checkPhoneNumberExists(this.value)">
    <span id="phoneError" style="color:red"></span><br>
    <!-- other form fields -->
    <input type="submit" value="Submit">
</form>
</body>
</html>